<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reaction Time Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script type="text/javascript">
        // Create the canvas and set its dimensions to match the screen
        const cvs = document.createElement("canvas");
        cvs.width = window.innerWidth;
        cvs.height = window.innerHeight;
        document.getElementById('container').appendChild(cvs);
        const ctx = cvs.getContext("2d");

        const maxCards = 10;
        const cardValues = Array.from({ length: maxCards }, (_, i) => i + 1);
        const cardsOnField = [];

        let pointToWin = 2;
        let goalNumber = 0;
        let playerScore = 0;
        let computerScore = 0;
        let isInteractable = false;
        let isStarted = false;
        let countdown = 3; // Countdown before the game starts
        let computerReactionTime = 1300;

        const cardWidth = 100;
        const cardHeight = 150;
        const cardSpacing = 50;
        const numCardsPerRow = 5;

        // Card class representing individual cards
        class Card {
            constructor(x, y, value) {
                this.x = x;
                this.y = y;
                this.width = cardWidth;
                this.height = cardHeight;
                this.value = value;
                this.color = "white";
                this.isHovered = false;  // Track if the card is hovered over
            }

            // Draw the card on the canvas
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                ctx.strokeStyle = this.isHovered ? "orange" : "black";  // Change the border color on hover
                ctx.lineWidth = this.isHovered ? 10 : 1;  // Make the border thicker when hovered
                ctx.strokeRect(this.x, this.y, this.width, this.height);
                ctx.font = "1.5rem Arial";
                ctx.fillStyle = "black";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(this.value, this.x + this.width / 2, this.y + this.height / 2);
            }

            // Check if a point is inside the card's area
            isPointInside(x, y) {
                return (
                    x >= this.x &&
                    x <= this.x + this.width &&
                    y >= this.y &&
                    y <= this.y + this.height
                );
            }
        }

        // StartButton class for displaying the "Start" button
        class StartButton {
            constructor() {
                this.x = cvs.width / 2;
                this.y = cvs.height * 0.75;
                this.radius = 50;
                this.color = "white";
            }

            // Draw the start button on the canvas
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = "black";
                ctx.lineWidth = 3;
                ctx.stroke();

                ctx.font = "2rem Arial";
                ctx.fillStyle = "black";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText("Start", this.x, this.y);
            }

            // Check if the start button is clicked
            isClicked(x, y) {
                const dx = x - this.x;
                const dy = y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                return distance <= this.radius;
            }
        }

        const startButton = new StartButton();

        // Main render function for displaying the game state
        function render() {
            ctx.clearRect(0, 0, cvs.width, cvs.height);

            if (!isStarted) {
                // Display the start screen with game rules
                ctx.font = "2rem Arial";
                ctx.textAlign = "center";
                ctx.fillStyle = "black";
                ctx.fillText(
                    `Pick the card with the same value as the goal number. Reach ${pointToWin} points first to win!`,
                    cvs.width / 2,
                    cvs.height * 0.25
                );
                startButton.draw();
            } else {
                if (countdown > 0) {
                    // Display countdown before the turn starts
                    ctx.font = "3rem Arial";
                    ctx.fillText(countdown, cvs.width / 2, cvs.height / 2);
                } else {
                    // Display the game interface with goal number and scores
                    ctx.font = "4rem Arial";
                    ctx.fillText(`Goal: ${goalNumber}`, cvs.width / 2, 150);
                    ctx.font = "2rem Arial";
                    ctx.fillText(
                        `Player: ${playerScore} - Computer: ${computerScore}`,
                        cvs.width / 2,
                        50
                    );
                    cardsOnField.forEach((card) => card.draw());
                }
            }
        }

        // Initialize a new turn by shuffling cards and setting a new goal number
        function startNextTurn() {
            if (!isStarted) {
                render();
                return;
            }

            goalNumber = Math.floor(Math.random() * maxCards) + 1;
            cardsOnField.length = 0;
            shuffleArray(cardValues);

            cardValues.forEach((value, index) => {
                const row = Math.floor(index / numCardsPerRow);
                const col = index % numCardsPerRow;
                const totalRowWidth = numCardsPerRow * cardWidth + (numCardsPerRow - 1) * cardSpacing;
                const canvasCenterX = cvs.width / 2;
                const startX = canvasCenterX - totalRowWidth / 2;
                const totalRowsHeight = 2 * cardHeight + cardSpacing;
                const canvasCenterY = cvs.height / 2;
                const startY = canvasCenterY - totalRowsHeight / 2;
                const x = startX + col * (cardWidth + cardSpacing);
                const y = startY + row * (cardHeight + cardSpacing);

                cardsOnField.push(new Card(x, y, value));
            });

            isInteractable = false;
            countdown = 2;

            const countdownInterval = setInterval(() => {
                if (countdown === 0) {
                    clearInterval(countdownInterval);
                    render();
                    isInteractable = true;
                    setTimeout(() => {
                        if (isInteractable) {
                            handleComputerPick();
                        }
                    }, computerReactionTime);
                } else {
                    countdown--;
                    render();
                }
            }, 1000);
        }

        // Handle player's pick of a card
        function handlePlayerPick(value) {
            if (value === goalNumber) {
                playerScore++;
                cardsOnField.find(card => card.value === value).color = "green";
                isInteractable = false;
                checkGameOver();
            }
        }

        // Handle computer's pick of a card
        function handleComputerPick() {
            const targetCard = cardsOnField.find(card => card.value === goalNumber);
            if (targetCard) {
                targetCard.color = "red";
                computerScore++;
            }
            isInteractable = false;
            checkGameOver();
        }

        // Check if the game is over and reset if necessary
        function checkGameOver() {
            render();

            if (playerScore === pointToWin) {
                setTimeout(() => {
                    ctx.clearRect(0, 0, cvs.width, cvs.height);
                    ctx.font = "4rem Arial";
                    ctx.textAlign = "center";
                    ctx.fillStyle = "black";
                    ctx.fillText(`You win!`, cvs.width / 2, cvs.height / 2);
                }, 500); // Show "You win!" for 0.5 seconds

                // Wait for 2 seconds before resetting the game
                setTimeout(() => {
                    resetGame();
                }, 2500);
                
            } else if (computerScore === pointToWin) {
                setTimeout(() => {
                    ctx.clearRect(0, 0, cvs.width, cvs.height);
                    ctx.font = "4rem Arial";
                    ctx.textAlign = "center";
                    ctx.fillStyle = "black";
                    ctx.fillText(`Computer wins!`, cvs.width / 2, cvs.height / 2);
                }, 500); // Show "Computer wins!" for 0.5 seconds

                // Wait for 2 seconds before resetting the game
                setTimeout(() => {
                    resetGame();
                }, 2500);

            // Neither computer nor player has won yet
            } else {
                // Càng ngày máy tính càng nhanh
                computerReactionTime -= 200;
                setTimeout(startNextTurn, 1000);
            }
        }

        // Reset the game state for a new round
        function resetGame() {
            playerScore = 0;
            computerScore = 0;
            computerReactionTime = 1300;
            isStarted = false;
            render();
        }

        // Shuffle array helper function
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Global mousedown event listener
        document.addEventListener("mousedown", (e) => {
            const mouseX = e.clientX;
            const mouseY = e.clientY;

            if (!isStarted) {
                if (startButton.isClicked(mouseX, mouseY)) {
                    isStarted = true;
                    startNextTurn();
                }
                return;
            }

            if (isInteractable) {
                cardsOnField.forEach(card => {
                    if (card.isPointInside(mouseX, mouseY)) {
                        if (card.value === goalNumber) {
                            handlePlayerPick(card.value);
                        }
                    }
                });
            }
        });

        // Global mousemove event listener for hover effect
        document.addEventListener("mousemove", (e) => {
            const mouseX = e.clientX;
            const mouseY = e.clientY;
            cardsOnField.forEach(card => {
                card.isHovered = card.isPointInside(mouseX, mouseY);
            });
            render();  // Redraw to apply hover effect
        });

        // Initial call to start the game
        render();
    </script>
</body>
</html>
